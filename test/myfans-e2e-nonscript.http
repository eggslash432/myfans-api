### ========== 変数 ==========
@host = http://localhost:3001
@json = application/json

# 認証用
@email = user3@example.com
@pass  = testtest
@role  = fan            

@token_fan =  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIzYjk2ZWE3MS05MThiLTQ3ZjAtYmUyMi1iYWJhZThiMzlkNjAiLCJlbWFpbCI6InVzZXIzQGV4YW1wbGUuY29tIiwicm9sZSI6ImZhbiIsImlhdCI6MTc2MDUwNDg1OCwiZXhwIjoxNzYwNTA4NDU4fQ.JGHD3G1PZpWvTgNSlNEQj2Fadk9JRG7izLtWwUhkhJE

@email_creator = creator1@example.com
@pass_creator  = testtest
@role_creator  = creator

@token_creator = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJkOTBiNDA0Zi0wYzk1LTQ5ZjEtODNhYy1hNTFhMTk4NDEzYzMiLCJlbWFpbCI6ImNyZWF0b3IxQGV4YW1wbGUuY29tIiwicm9sZSI6ImNyZWF0b3IiLCJpYXQiOjE3NjA1MDc2ODksImV4cCI6MTc2MDUxMTI4OX0.gfnmMvnXh9wP-l_bol4mB8MvmTaHBrO3fVi5wjSZydY
@creatorId =  d90b404f-0c95-49f1-83ac-a51a198413c3

@ppvPostId =  1d5db5ae-d3ce-47bc-8988-71cb09713d4c
# Stripe Webhook は /payments/webhook
### =========================


### 1) 閲覧用ユーザーのサインアップ（※ role 必須）
POST {{host}}/auth/signup
Content-Type: {{json}}

{
  "email": "{{email}}",
  "password": "{{pass}}",
  "role": "{{role}}"
}

### 1) クリエイター用ユーザーのサインアップ（※ role 必須）
POST {{host}}/auth/signup
Content-Type: {{json}}

{
  "email": "{{email_creator}}",
  "password": "{{pass_creator}}",
  "role": "{{role_creator}}"
}

### 2) 閲覧用ユーザーのログイン（accessToken を @token にコピペ）
POST {{host}}/auth/login
Content-Type: {{json}}

{
  "email": "{{email}}",
  "password": "{{pass}}"
}

### 2) 投稿用ユーザーのログイン
POST {{host}}/auth/login
Content-Type: {{json}}

{
  "email": "{{email_creator}}",
  "password": "{{pass_creator}}"
}

### 3) クリエイター登録（publicName or displayName のどちらか必須）
POST {{host}}/creators
Authorization: Bearer {{token_creator}}
Content-Type: {{json}}

{
  "publicName": "クリエイター次郎",
  "displayName": "TaroCreator",
  "bio": "自己紹介"
}
# レスポンスに id が返れば @creatorId に貼る（無くても次へ進める）


### 4) プラン作成（CreatePlanDto: priceJpy のみ）
# A) creatorId が不要な実装（このコードは userId→creator を内部解決）
POST {{host}}/plans
Authorization: Bearer {{token_creator}}
Content-Type: {{json}}

{
  "name": "月額1980円プラン",
  "priceJpy": 1980
}


### 5) プラン一覧（自分のプラン）
GET {{host}}/plans
Authorization: Bearer {{token_creator}}

### 投稿一覧
GET {{host}}/creators/me/posts
Authorization: Bearer {{token_creator}}

###
# 2️⃣ 閲覧用ユーザー情報を取得（JWT確認）
GET {{host}}/auth/me
Authorization: Bearer {{token_fan}}
Content-Type: application/json

###
# 2️⃣ クリエイターユーザー情報を取得（JWT確認）
GET {{host}}/auth/me
Authorization: Bearer {{token_creator}}
Content-Type: application/json

### サブスクCheckoutセッション作成（プラン加入）
POST {{host}}/payments/checkout/session
Authorization: Bearer {{token_fan}}       
Content-Type: application/json

{
  "planId": "e18cead5-813b-48ca-ac23-ab7c8816a2f2",
  "successUrl": "https://example.com/success",
  "cancelUrl": "https://example.com/cancel"
}

###ヘルス&プレフィックス確認
GET {{host}}/health

### 反映確認（購読一覧 & サマリー）
GET {{host}}/subscriptions
Authorization: Bearer {{token_fan}}

### サマリー
GET {{host}}/users/me/summary
Authorization: Bearer {{token_fan}}

### 2) Webhook（テスト用）
POST {{host}}/payments/webhooks/stripe
Content-Type: application/json
Stripe-Signature: test

{
  "id": "evt_test_sub_001",
  "type": "checkout.session.completed",
  "data": { "object": {
    "id": "cs_test_001",
    "mode": "subscription",
    "subscription": "sub_test_001",
    "metadata": { "userId": "3b96ea71-918b-47f0-be22-babae8b39d60", "planId": "e18cead5-813b-48ca-ac23-ab7c8816a2f2" }
  } }
}